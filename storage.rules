rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Regla para la carpeta de códigos QR
    match /qrcodes/{userId}/{allPaths=**} {
      // PERMITIR LECTURA: Cualquier usuario autenticado puede leer las imágenes.
      // Esto es generalmente seguro para archivos como los QR que se mostrarán en la app.
      allow read: if request.auth != null;

      // PERMITIR ESCRITURA (SUBIDA): Solo el usuario propietario de la carpeta puede subir archivos.
      // request.auth.uid es el ID del usuario que hace la petición.
      // {userId} es el ID en la ruta del archivo.
      // Esta condición asegura que un partner solo pueda subir un QR a su propia carpeta.
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
